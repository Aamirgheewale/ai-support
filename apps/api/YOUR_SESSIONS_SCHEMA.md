# Your Sessions Collection Schema

Based on your actual Appwrite collection, here's what's stored:

## Your Collection Fields

| Field | Type | Description | Auto-Generated |
|-------|------|-------------|----------------|
| **$id** | String | Document ID | ‚úÖ Yes |
| **sessionId** | String | Unique session identifier | ‚ùå No |
| **userMeta** | String (JSON) | User information | ‚ùå No |
| **status** | String | Session status | ‚ùå No |
| **lastSeen** | DateTime | Last activity time | ‚ùå No |
| **theme** | String (JSON) | Theme settings | ‚ùå No |
| **startTime** | DateTime | Session start time | ‚ùå No |
| **$createdAt** | DateTime | Creation timestamp | ‚úÖ Yes |
| **$updatedAt** | DateTime | Last update timestamp | ‚úÖ Yes |

## What Each Field Stores

### Core Fields

1. **$id** - Auto-generated by Appwrite
   - Unique document identifier
   - Format: Usually matches sessionId or auto-generated

2. **sessionId** - Unique session identifier
   - Example: `s_1763614351136`
   - Used to link messages to sessions

3. **status** - Current session state
   - Values: `"active"`, `"agent_assigned"`, `"closed"`, etc.
   - Default: `"active"`

4. **startTime** - When session started
   - Set when user first opens chat
   - Format: ISO datetime string

5. **lastSeen** - Last activity timestamp
   - Updates every time user sends a message
   - Used to track active users

### Optional Fields

6. **userMeta** - Additional user information
   - Stored as JSON string
   - Can include: browser, device, location, etc.
   - Example: `{"browser":"Chrome","device":"Desktop"}`

7. **theme** - Custom theme settings
   - Stored as JSON string
   - Customizes chat widget appearance
   - Example: `{"primaryColor":"#007bff"}`

### Auto-Generated Fields

8. **$createdAt** - When document was created
   - Auto-set by Appwrite
   - Same as startTime (usually)

9. **$updatedAt** - When document was last updated
   - Auto-updated by Appwrite
   - Updates when lastSeen changes

## Code Updates Made

The code has been updated to match your schema:

‚úÖ **Removed fields that don't exist:**
- `needsHuman` - Not in your collection
- `assignedAgent` - Not in your collection

‚úÖ **Added support for:**
- `startTime` - Now sets when session is created

‚úÖ **Uses auto-generated fields:**
- `$createdAt` - Auto-set by Appwrite
- `$updatedAt` - Auto-updated by Appwrite

## Example Session Document

```json
{
  "$id": "s_1763614351136",
  "sessionId": "s_1763614351136",
  "status": "active",
  "startTime": "2024-12-15T14:25:10.123Z",
  "lastSeen": "2024-12-15T14:30:45.123Z",
  "userMeta": "{\"browser\":\"Chrome\"}",
  "theme": "{}",
  "$createdAt": "2024-12-15T14:25:10.123Z",
  "$updatedAt": "2024-12-15T14:30:45.123Z"
}
```

## Viewing Your Sessions

Run the updated script:
```bash
cd ai-support/apps/api
node view_sessions.js
```

It will show:
- ‚úÖ Session ID
- ‚úÖ Status
- ‚úÖ Start Time
- ‚úÖ Last Seen (with "time ago" calculation)
- ‚úÖ User Meta (if available)
- ‚úÖ Theme (if customized)
- ‚úÖ Message count per session

## Notes

- **startTime** = When session was created (first chat)
- **lastSeen** = Last message timestamp (updates on each message)
- **$createdAt** = Same as startTime (usually)
- **$updatedAt** = Updates whenever lastSeen changes

The code now perfectly matches your collection schema! üéâ

